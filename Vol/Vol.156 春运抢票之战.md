# Vol.156 春运抢票之战

春运又来了，你打开 12306 准备抢票，一开票，秒光。

不死心的你又打开抢票软件，决定把今年的 50 元年终奖拿来升级成光速抢票，显示成功率高达 78.87%，你又看到了回家的希望。

![Vol/Vol.156 春运抢票之战/1.gif](https://cdn.jsdelivr.net/gh/just-prog/static/image/Vol/Vol.156%20春运抢票之战/1.gif)

这些软件真的能抢到票吗？在近十年里，12306 又是如何跟抢票软件和黄牛做斗争？

首先要知道，除了这些 App，还有各种民间开发、使用的抢票软件，它们手里其实并没有票，只是帮你在唯一的官方售票网站 12306 买票。

![Vol/Vol.156 春运抢票之战/2.gif](https://cdn.jsdelivr.net/gh/just-prog/static/image/Vol/Vol.156%20春运抢票之战/2.gif)

进入网站，选择日期和站点查询，预定车次，选定乘车人、票种、席别、座位，提交订单，就算你手速快一点也要几十秒。

而抢票软件则可以连接 12306 的服务器自动执行这个过程，将查询余票的时间缩短至毫秒级别，完成下单支付也不过几秒。

![Vol/Vol.156 春运抢票之战/3.gif](https://cdn.jsdelivr.net/gh/just-prog/static/image/Vol/Vol.156%20春运抢票之战/3.gif)

如果你加钱或许还能分配到更大带宽的网络专线、更多的服务器，没日没夜地查，只要有票就会迅速下手，这么看抢票软件确实有用。

但事情没那么简单，12306 可不会坐视不管。

![Vol/Vol.156 春运抢票之战/4.gif](https://cdn.jsdelivr.net/gh/just-prog/static/image/Vol/Vol.156%20春运抢票之战/4.gif)

2011 年 6 月 1 日，耗资 3.29 亿的 12306 网站上线，但粗糙的网站设计让 12306 在当时几年的春运抢票中一直频出故障，从 2013 年涌现的一批抢票软件更是让 12306 雪上加霜，造成网站波动，影响正常买票，助长猖獗的黄牛抢票囤票。

为了遏制抢票软件，12306 在 2015 年出了一招——图形验证码！

![Vol/Vol.156 春运抢票之战/5.gif](https://cdn.jsdelivr.net/gh/just-prog/static/image/Vol/Vol.156%20春运抢票之战/5.gif)

这些模糊刁钻的图形验证码在最开始不仅能挡机器人，连真人都挡，频繁刷新后还会升级为 18 张图片双词验证，一度成为购票者的噩梦。来试试吧，选不对就不让登录。

但抢票软件也有对抗手段——机器学习！

![Vol/Vol.156 春运抢票之战/6.gif](https://cdn.jsdelivr.net/gh/just-prog/static/image/Vol/Vol.156%20春运抢票之战/6.gif)

利用机器学习识别图像，抢票软件的开发者称一度将双词验证的识别率从 10% 提升到 80% 。

就算机器识别不出来，抢票软件还有一招——人工打码！

![Vol/Vol.156 春运抢票之战/7.gif](https://cdn.jsdelivr.net/gh/just-prog/static/image/Vol/Vol.156%20春运抢票之战/7.gif)

这是一条黑色产业链，使用抢票软件的黄牛可以花钱把 12306 的验证码交给打码平台处理。打码平台又会与各种网赚平台合作，大量招募佣工并提供打码软件。

然后由佣工人工点击图形验证码后，再将结果一步步返回 12306。像图形验证码这种难度高的，佣工每打 100 个码在当时大概能赚一块钱。

![Vol/Vol.156 春运抢票之战/8.gif](https://cdn.jsdelivr.net/gh/just-prog/static/image/Vol/Vol.156%20春运抢票之战/8.gif)

利用图像识别和人海战术，图形验证码已经敌不过抢票软件。

但 12306 没有气馁，采取了更严格的措施——封锁 IP！

![Vol/Vol.156 春运抢票之战/9.gif](https://cdn.jsdelivr.net/gh/just-prog/static/image/Vol/Vol.156%20春运抢票之战/9.gif)

2015 年开始，12306 一旦识别到某个 IP 地址查票频率过高，就直接封锁拒绝提供服务，在最初有效阻止了抢票软件疯狂刷票。

但也造成了误伤，当同一个单位或小区的大量民众一起买票，如果是局域网共用一个 IP，也可能被识别为刷票而被封锁。

但抢票软件也有一招——IP 变换！

![Vol/Vol.156 春运抢票之战/10.gif](https://cdn.jsdelivr.net/gh/just-prog/static/image/Vol/Vol.156%20春运抢票之战/10.gif)

通过使用多台服务器轮流操作、快速更换 IP 地址的方法绕开 12306 的封锁规则。

但 12306 也没闲着，一直在暗中观察憋大招——大数据算法模型！

![Vol/Vol.156 春运抢票之战/11.gif](https://cdn.jsdelivr.net/gh/just-prog/static/image/Vol/Vol.156%20春运抢票之战/11.gif)

2018 年，12306 的技术部主任单杏花发表了这篇论文，基于 2017 年所有购票数据和用户购票日志研究出一个算法模型。可以提取 CDN 地址变换频率、退改签比例、页面平均查询频率等 25 种特征向量用来识别异常用户，预测准确度达到 80% 。

![Vol/Vol.156 春运抢票之战/12.jpeg](https://cdn.jsdelivr.net/gh/just-prog/static/image/Vol/Vol.156%20春运抢票之战/12.jpeg)

同年，12306 开始运行新的风控系统，抢票软件抢得有多凶，系统拦截得就有多狠。去年春运某日，12306 开售 3 小时就接到 183.6 亿次访问请求，其中有一半以上都被拦截。

不仅要拦，12306 还想断了抢票软件的捷径，使出了杀招——候补购票！

![Vol/Vol.156 春运抢票之战/13.gif](https://cdn.jsdelivr.net/gh/just-prog/static/image/Vol/Vol.156%20春运抢票之战/13.gif)

2019 年，12306 的候补购票功能覆盖所有旅客列车，其实就是在官方渠道排队抢票，当你选择了候补购票就会自动在官网排队，有余票、退票将优先分配给你，抢票软件只能在官方捡漏后再捡漏。

当年春运的候补购票订单兑现率达到 80% 左右，比抢票软件上不明所以标注的成功率靠谱得多。

![Vol/Vol.156 春运抢票之战/14.gif](https://cdn.jsdelivr.net/gh/just-prog/static/image/Vol/Vol.156%20春运抢票之战/14.gif)

候补购票也让黄牛更不好干了。以往他们还可以用抢票软件大量囤票，然后通过退票再抢票的方式转让给购票者。但现在退票将优先分配给候补购票的乘客，让黄牛囤票也没用。

经过十年的较量，如今的 12306 已经肉眼可见地升级成全球最大规模的实时票务交易系统。2012 年的最高峰日售票量仅 276 万张，到 2020 年已高达 1443 万张。

![Vol/Vol.156 春运抢票之战/15.gif](https://cdn.jsdelivr.net/gh/just-prog/static/image/Vol/Vol.156%20春运抢票之战/15.gif)

当然，12306 与抢票软件、黄牛的斗争仍将持续。不过，今年因为疫情，春运出行人数减少，你大概用不着抢票了。

![Vol/Vol.156 春运抢票之战/16.png](https://cdn.jsdelivr.net/gh/just-prog/static/image/Vol/Vol.156%20春运抢票之战/16.png)

不论是选择就地过年还是回家与亲人团聚，都还是要做好防疫措施，开心过年。毕竟，虽然不用抢票，但群里的红包还是得抢一抢！
